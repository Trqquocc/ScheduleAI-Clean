<!-- pages/work.html -->
<div class="container mx-auto p-4">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">Qu·∫£n l√Ω c√¥ng vi·ªác</h1>
    <button
      id="create-task-btn"
      class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2"
    >
      <i class="fas fa-plus"></i>
      T·∫°o c√¥ng vi·ªác m·ªõi
    </button>
  </div>

  <!-- Container c√¥ng vi·ªác -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200">
    <div class="p-4 border-b border-gray-200">
      <h2 class="text-lg font-semibold text-gray-700">Danh s√°ch c√¥ng vi·ªác</h2>
    </div>

    <div id="work-items-container" class="p-4">
      <!-- N·ªôi dung c√¥ng vi·ªác s·∫Ω ƒë∆∞·ª£c t·∫£i ·ªü ƒë√¢y -->
      <div class="text-center py-8 text-gray-500">
        <div
          class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"
        ></div>
        <div>ƒêang t·∫£i c√¥ng vi·ªác...</div>
      </div>
    </div>
  </div>

  <!-- Fallback UI n·∫øu c√≥ l·ªói -->
  <div id="work-error-container" class="hidden">
    <div class="text-center py-8 text-red-500">
      <div class="text-lg mb-2">‚ùå Kh√¥ng th·ªÉ t·∫£i danh s√°ch c√¥ng vi·ªác</div>
      <button
        onclick="if(window.WorkManager) WorkManager.reload()"
        class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"
      >
        Th·ª≠ l·∫°i
      </button>
    </div>
  </div>
</div>

<script>
  (function () {
    "use strict";

    console.log("üìã Work page loaded");

    // Kh·ªüi t·∫°o khi DOM ready
    function initWorkPage() {
      console.log("üîß Initializing work page...");

      // Ki·ªÉm tra dependencies
      if (typeof Utils === "undefined") {
        console.warn("‚ö†Ô∏è Utils not loaded, waiting...");
        setTimeout(initWorkPage, 200);
        return;
      }

      if (typeof ModalManager === "undefined") {
        console.warn("‚ö†Ô∏è ModalManager not loaded, waiting...");
        setTimeout(initWorkPage, 200);
        return;
      }

      // Bind n√∫t t·∫°o c√¥ng vi·ªác
      const createBtn = document.getElementById("create-task-btn");
      if (createBtn) {
        // Remove old listeners
        const newBtn = createBtn.cloneNode(true);
        createBtn.parentNode.replaceChild(newBtn, createBtn);

        // Add new listener
        newBtn.addEventListener("click", () => {
          console.log("üéØ Create task button clicked");

          if (window.ModalManager) {
            console.log("üìÇ Opening createTaskModal...");
            ModalManager.showModalById("createTaskModal");
          } else {
            console.error("‚ùå ModalManager not available");
            if (window.Utils && Utils.showToast) {
              Utils.showToast(
                "Kh√¥ng th·ªÉ m·ªü modal, vui l√≤ng t·∫£i l·∫°i trang",
                "error"
              );
            }
          }
        });

        console.log("‚úÖ Create task button initialized");
      } else {
        console.warn("‚ö†Ô∏è Create task button not found");
      }

      // Load work items n·∫øu WorkManager c√≥ s·∫µn
      if (window.WorkManager) {
        console.log("üì¶ Loading work items...");
        if (typeof WorkManager.init === "function") {
          WorkManager.init();
        } else if (typeof WorkManager.reload === "function") {
          WorkManager.reload();
        }
      } else {
        console.warn("‚ö†Ô∏è WorkManager not available yet");
      }

      console.log("‚úÖ Work page initialized");
    }

    // Start initialization
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initWorkPage);
    } else {
      setTimeout(initWorkPage, 100);
    }
  })();
</script>
